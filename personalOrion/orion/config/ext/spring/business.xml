<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:p="http://www.springframework.org/schema/p" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:dcits="http://code.alibabatech.com/schema/dubbo"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://code.alibabatech.com/schema/dubbo
        http://code.alibabatech.com/schema/dubbo/dubbo.xsd">
    <!-- 加载资源配置文件 -->
    <bean id="propertyConfigurerBusi"
          class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="ignoreUnresolvablePlaceholders" value="true"/>
        <property name="locations">
            <list>
                <value>classpath*:galaxy.properties</value>
            </list>
        </property>
    </bean>

    <!-- ***************************************延时服务发布 start******************************** -->
    <dcits:provider delay="3000"/>
    <!-- ***************************************延时服务发布 end******************************** -->
    <!-- ***************************************行级缓存配置 start******************************** -->
    <!-- 系统参数级缓存 -->
    <bean id="SystemParamCache" class="com.dcits.galaxy.cache.global.RedisCache"
          p:name="param" p:period="0"/>

    <!-- 业务级缓存 -->
    <bean id="BusinessParamCache" class="com.dcits.galaxy.cache.global.RedisCache"
          p:name="business" p:period="3"/>

    <!-- ***************************************业务服务配置 start******************************** -->
    <!-- 系统公共检查服务，发布为RPC远程服务，例如可以设置上下文信息、系统公共层面检查等业务处理
         业务可以在这个处理中，将runDate赋值给SysHead.runDate，框架将回在输出中返回runDate，若不配置将不跳过检查 -->
    <dcits:service group="${galaxy.application.group}" interface="com.dcits.orion.api.SystemCheck"
                   ref="busiSystemCheck"/>

    <!-- 服务后置处理，例如清楚上下文操作、以及服务后的系统公共业务处理等，若不配置将不跳过处理  -->
    <dcits:service group="${galaxy.application.group}" interface="com.dcits.orion.api.AfterService"
                   ref="busiAfterService"/>

    <!-- 业务流水号由具体业务实现，框架会填充到SysHead.reference中，若不配置将不跳过检查无法对SysHead.reference赋值  -->
    <dcits:service group="${galaxy.application.group}" interface="com.dcits.orion.api.BusinessTraceNo"
                   ref="businessTraceNo"/>
    <!-- ***************************************业务服务配置 end******************************** -->

    <!-- ***************************************报文转换部分 start******************************** -->
    <!-- cd格式的xml  -->
    <bean id="xmlConvert" class="com.dcits.orion.base.xml.XmlConvert">
    </bean>
    <!--<property name="configLocation" value="classpath:parseStringCfg.xml"/>-->
    <!-- json报文  -->
    <!-- <bean id="jsonConvert" class="com.dcits.orion.base.json.JsonConvert"/> -->
	<bean id="jsonConvert" class="com.dcits.orion.base.json.JsonConvert" init-method="initJsonConfig">
		<property name="jsonConfig">
			<bean class="com.dcits.orion.base.json.JsonConfig"/>
		</property>
	</bean>
    <!-- json报文转换工厂 id名称必须保证为（convertFactory）  -->
    <bean id="convertFactory" class="com.dcits.orion.base.ConvertFactory">
        <property name="converts">
            <map>
                <entry key="xml" value-ref="xmlConvert"/>
                <entry key="json" value-ref="jsonConvert"/>
            </map>
        </property>
    </bean>
    <!-- ***************************************报文转换部分 end******************************** -->

    <!-- ***********************************应用系统 health check start************************* -->
    <!-- id名称必须保证为（appHealthCheck）   -->
    <bean id="appHealthCheck" class="com.dcits.galaxy.oms.monitor.health.AppHealthCheckFactory">
        <property name="checkList">
            <list>
                <!-- 此处放置各应用实现的IAppHealthCheck的bean 以便业务后续扩展使用 -->
            </list>
        </property>
    </bean>
    <dcits:service interface="com.dcits.galaxy.oms.monitor.api.health.IAppHealthCheck" ref="appHealthCheck"/>
    <!-- ***********************************应用系统 health check start************************* -->

    <!-- ***********************************zk互斥线程  start************************* -->
    <bean id="zkThreads" class="com.dcits.orion.core.zookeeper.ZkThreads">
        <property name="threadNames">
            <list>
<!--                 <value>com.dcits.ensemble.busi.base.job.MbBatchOpenThread|6000|100</value> -->
				<value>com.dcits.orion.batch.common.TimerThread|6000|100</value>
            </list>
        </property>
    </bean>
    <!-- ***********************************zk互斥线程  start************************* -->

    <!-- ***********************EOD Batch init start *********************** 
    <bean id="batchLocal" class="com.dcits.ensemble.eod.base.EnsBatchLocal"/>
    -->
    <!-- ***********************EOD Batch init end  ************************ -->
</beans>