<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dcits.galaxy.sequences.dao.OracleSeqDao">
    <insert id="create" parameterType="com.dcits.galaxy.sequences.model.Sequences">
        CREATE SEQUENCE ${seqName}
        INCREMENT BY ${seqIncrementBy}
        START WITH ${seqMinValue}
        MAXVALUE ${seqMaxValue}
        MINVALUE ${seqMinValue}
        NOCACHE
        NOCYCLE
    </insert>

    <select id="getSeq" parameterType="com.dcits.galaxy.sequences.model.Sequences" resultType="java.lang.Long">
        select ${seqName}.nextval id from dual
    </select>

    <select id="getSeqList" parameterType="com.dcits.galaxy.sequences.model.Sequences" resultType="java.lang.Long">
        select ${seqName}.nextval id from dual connect by level <![CDATA[<=]]> #{seqCount}
    </select>

    <select id="containsSequence" parameterType="java.util.Map"
            resultType="java.lang.Integer">
        SELECT COUNT(1) COUNT
        FROM ALL_SEQUENCES
        WHERE SEQUENCE_NAME = #{seqName}
        <if test="user != null">
            AND SEQUENCE_OWNER = #{user}
        </if>
    </select>

    <select id="getSequences" parameterType="java.util.Map"
            resultType="com.dcits.galaxy.sequences.model.Sequences">
        SELECT SEQUENCE_NAME SEQ_NAME,
        LAST_NUMBER SEQ_CURRENT_VALUE,
        MAX_VALUE SEQ_MAX_VALUE,
        MIN_VALUE SEQ_MIN_VALUE,
        INCREMENT_BY SEQ_INCREMENT_BY,
        CYCLE_FLAG SEQ_CYCLE,
        CACHE_SIZE SEQ_CACHE
        FROM ALL_SEQUENCES
        <if test="user != null">
            WHERE SEQUENCE_OWNER = #{user}
        </if>
    </select>

    <select id="getLikeSequences" parameterType="java.util.Map"
            resultType="com.dcits.galaxy.sequences.model.Sequences">
        SELECT SEQUENCE_OWNER SEQ_OWNER,
        SEQUENCE_NAME SEQ_NAME,
        LAST_NUMBER SEQ_CURRENT_VALUE,
        MAX_VALUE SEQ_MAX_VALUE,
        MIN_VALUE SEQ_MIN_VALUE,
        INCREMENT_BY SEQ_INCREMENT_BY,
        CYCLE_FLAG SEQ_CYCLE,
        CACHE_SIZE SEQ_CACHE
        FROM ALL_SEQUENCES
        WHERE SEQUENCE_NAME like '%'||#{seqName}||'%'
        <if test="user != null">
            AND SEQUENCE_OWNER = #{user}
        </if>
    </select>
</mapper>