<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dcits.ensemble.om.oms.dao.middleware.EcmMidwareinstDeployDao">
  <!-- Created by oms on 2016/02/16 10:54:34. -->
  <select id="selectByPrimaryKey" parameterType="com.dcits.ensemble.om.oms.module.middleware.EcmMidwareinstDeploy" resultType="com.dcits.ensemble.om.oms.module.middleware.EcmMidwareinstDeploy">
    select *
    from ECM_MIDWAREINST_DEPLOY
    where MIDWARE_DEPLOY_ID = #{midwareDeployId,jdbcType=INTEGER}
  </select>
   <select id="findList" parameterType="com.dcits.galaxy.dal.mybatis.proactor.page.ParameterWrapper" resultType="com.dcits.ensemble.om.oms.module.middleware.EcmMidwareinstDeploy">
    select a.MIDWARE_DEPLOY_DATE,a.MIDWARE_TYPE,b.MIDWARE_NAME,b.MIDWARE_PATH,c.REDISINT_NAME as INSTANT_NAME,
	c.REDISINT_TYPE as INSTANT_TYPE,d.MIDWARE_VER_NO,e.USER_NAME,f.SER_IP
	from ecm_midwareinst_deploy a,ecm_midware_info b,ecm_midware_redisint c,ecm_midware_ver d,web_user e,ecm_server_info f
	where a.MIDWARE_INTANT_ID = c.REDISINT_ID and c.MIDWARE_ID= b.MIDWARE_ID and a.MIDWARE_VER_ID = d.MIDWARE_VER_ID
    and a.MIDWARE_DEPLOY_USERID = e.USER_ID and c.SER_ID = f.SER_ID  and a.MIDWARE_TYPE='0006001'

     <if test="baseParam.userId != null">
       AND e.USER_ID= #{baseParam.userId ,jdbcType=VARCHAR}
     </if>
     <if test="baseParam.midwareType!= null">
        AND a.MIDWARE_TYPE = #{baseParam.midwareType,jdbcType=VARCHAR}
     </if>
      <if test="baseParam.startTime!=null">
      <if test="baseParam.endTime!=null">
      AND <![CDATA[
      a.MIDWARE_DEPLOY_DATE >= #{baseParam.startTime,jdbcType=VARCHAR} and a.MIDWARE_DEPLOY_DATE<= #{baseParam.endTime,jdbcType=VARCHAR}
      ]]>
      </if>
      </if>      
	  UNION  ALL 
	select a.MIDWARE_DEPLOY_DATE,a.MIDWARE_TYPE,b.MIDWARE_NAME,b.MIDWARE_PATH,c.ZKINT_NAME as INSTANT_NAME,
	NULL as INSTANT_TYPE,d.MIDWARE_VER_NO,e.USER_NAME,f.SER_IP
	from ecm_midwareinst_deploy a,ecm_midware_info b,ecm_midware_zkint c,ecm_midware_ver d,web_user e,ecm_server_info f
	where a.MIDWARE_INTANT_ID = c.ZKINT_ID and c.MIDWARE_ID= b.MIDWARE_ID and a.MIDWARE_VER_ID = d.MIDWARE_VER_ID
    and a.MIDWARE_DEPLOY_USERID = e.USER_ID and c.SER_ID = f.SER_ID and a.MIDWARE_TYPE='0006002'
    <if test="baseParam.userId != null">
       AND e.USER_ID= #{baseParam.userId ,jdbcType=VARCHAR}
     </if>
     <if test="baseParam.midwareType!= null">
        AND a.MIDWARE_TYPE = #{baseParam.midwareType,jdbcType=VARCHAR}
     </if>
      <if test="baseParam.startTime!=null">
      <if test="baseParam.endTime!=null">
      AND <![CDATA[
      a.MIDWARE_DEPLOY_DATE >= #{baseParam.startTime,jdbcType=VARCHAR} and a.MIDWARE_DEPLOY_DATE<= #{baseParam.endTime,jdbcType=VARCHAR}
      ]]>
      </if>
      </if> 
      ORDER BY MIDWARE_DEPLOY_DATE DESC
  </select>
  <delete id="deleteByPrimaryKey" parameterType="com.dcits.ensemble.om.oms.module.middleware.EcmMidwareinstDeploy">
    delete from ECM_MIDWAREINST_DEPLOY
    where MIDWARE_DEPLOY_ID = #{midwareDeployId,jdbcType=INTEGER}
  </delete>
  <update id="updateByPrimaryKey" parameterType="com.dcits.ensemble.om.oms.module.middleware.EcmMidwareinstDeploy">
    update ECM_MIDWAREINST_DEPLOY
    <set>
      <if test="midwareIntantId != null">
        MIDWARE_INTANT_ID = #{midwareIntantId,jdbcType=INTEGER},
      </if>
      <if test="midwareType != null">
        MIDWARE_TYPE = #{midwareType,jdbcType=VARCHAR},
      </if>
      <if test="midwareVerId != null">
        MIDWARE_VER_ID = #{midwareVerId,jdbcType=INTEGER},
      </if>
      <if test="midwareDeployDate != null">
        MIDWARE_DEPLOY_DATE = #{midwareDeployDate,jdbcType=VARCHAR},
      </if>
      <if test="midwareDeployUserid != null">
        MIDWARE_DEPLOY_USERID = #{midwareDeployUserid,jdbcType=INTEGER}
      </if>
    </set>
    where MIDWARE_DEPLOY_ID = #{midwareDeployId,jdbcType=INTEGER}
  </update>
  <insert id="insert" parameterType="com.dcits.ensemble.om.oms.module.middleware.EcmMidwareinstDeploy">
    insert into ECM_MIDWAREINST_DEPLOY
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="midwareDeployId != null">
        MIDWARE_DEPLOY_ID,
      </if>
      <if test="midwareIntantId != null">
        MIDWARE_INTANT_ID,
      </if>
      <if test="midwareType != null">
        MIDWARE_TYPE,
      </if>
      <if test="midwareVerId != null">
        MIDWARE_VER_ID,
      </if>
      <if test="midwareDeployDate != null">
        MIDWARE_DEPLOY_DATE,
      </if>
      <if test="midwareDeployUserid != null">
        MIDWARE_DEPLOY_USERID,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="midwareDeployId != null">
        #{midwareDeployId,jdbcType=INTEGER},
      </if>
      <if test="midwareIntantId != null">
        #{midwareIntantId,jdbcType=INTEGER},
      </if>
      <if test="midwareType != null">
        #{midwareType,jdbcType=VARCHAR},
      </if>
      <if test="midwareVerId != null">
        #{midwareVerId,jdbcType=INTEGER},
      </if>
      <if test="midwareDeployDate != null">
        #{midwareDeployDate,jdbcType=VARCHAR},
      </if>
      <if test="midwareDeployUserid != null">
        #{midwareDeployUserid,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
</mapper>