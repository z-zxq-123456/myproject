<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dcits.ensemble.om.oms.dao.middleware.EcmMidwareoprInfoDao">
  <!-- Created by oms on 2016/02/16 10:54:34. -->
  <select id="selectByPrimaryKey" parameterType="com.dcits.ensemble.om.oms.module.middleware.EcmMidwareoprInfo" resultType="com.dcits.ensemble.om.oms.module.middleware.EcmMidwareoprInfo">
    select *
    from ECM_MIDWAREOPR_INFO
    where MIDWARE_OPER_ID = #{midwareOperId,jdbcType=INTEGER}
  </select>
  <select id="findList" parameterType="com.dcits.ensemble.om.oms.module.middleware.EcmMidwareoprInfo" resultType="com.dcits.ensemble.om.oms.module.middleware.EcmMidwareoprInfo">
  select a.MIDWARE_OPER_TIME,a.MIDWARE_TYPE,a.MIDWARE_OPER_TYPE,b.MIDWARE_NAME,b.MIDWARE_PATH,c.REDISINT_NAME as INSTANT_NAME,
	c.REDISINT_TYPE as INSTANT_TYPE,d.MIDWARE_VER_NO,e.USER_NAME,f.SER_IP
	from ecm_midwareopr_info a,ecm_midware_info b,ecm_midware_redisint c,ecm_midware_ver d,web_user e,ecm_server_info f
	where a.MIDWARE_INTANT_ID = c.REDISINT_ID and c.MIDWARE_ID= b.MIDWARE_ID and b.MIDWARE_VER_ID = d.MIDWARE_VER_ID
    and a.MIDWARE_OPER_USERID = e.USER_ID and c.SER_ID = f.SER_ID  and a.MIDWARE_TYPE='0006001'
     <if test="baseParam.userId != null">
       AND e.USER_ID= #{baseParam.userId ,jdbcType=VARCHAR}
     </if>
     <if test="baseParam.midwareType!= null">
        AND a.MIDWARE_TYPE = #{baseParam.midwareType,jdbcType=VARCHAR}
     </if>
     <if test="baseParam.midwareOperType != null">
       AND a.MIDWARE_OPER_TYPE= #{baseParam.midwareOperType ,jdbcType=VARCHAR}
      </if>
      <if test="baseParam.startTime!=null">
      <if test="baseParam.endTime!=null">
      AND <![CDATA[
      a.MIDWARE_OPER_TIME >= #{baseParam.startTime,jdbcType=VARCHAR} and a.MIDWARE_OPER_TIME<= #{baseParam.endTime,jdbcType=VARCHAR}
      ]]>
      </if>
      </if>     
    UNION  ALL  
    select a.MIDWARE_OPER_TIME,a.MIDWARE_TYPE,a.MIDWARE_OPER_TYPE,b.MIDWARE_NAME,b.MIDWARE_PATH,c.ZKINT_NAME as INSTANT_NAME,
	NULL as INSTANT_TYPE,d.MIDWARE_VER_NO,e.USER_NAME,f.SER_IP
	from ecm_midwareopr_info a,ecm_midware_info b,ecm_midware_zkint c,ecm_midware_ver d,web_user e,ecm_server_info f
	where a.MIDWARE_INTANT_ID = c.ZKINT_ID and c.MIDWARE_ID= b.MIDWARE_ID and B.MIDWARE_VER_ID = d.MIDWARE_VER_ID
    and a.MIDWARE_OPER_USERID = e.USER_ID and c.SER_ID = f.SER_ID and a.MIDWARE_TYPE='0006002'
    <if test="baseParam.userId != null">
       AND e.USER_ID= #{baseParam.userId ,jdbcType=VARCHAR}
     </if>
     <if test="baseParam.midwareType!= null">
        AND a.MIDWARE_TYPE = #{baseParam.midwareType,jdbcType=VARCHAR}
     </if>
     <if test="baseParam.midwareOperType != null">
       AND a.MIDWARE_OPER_TYPE= #{baseParam.midwareOperType ,jdbcType=VARCHAR}
      </if>
      <if test="baseParam.startTime!=null">
      <if test="baseParam.endTime!=null">
      AND <![CDATA[
      a.MIDWARE_OPER_TIME >= #{baseParam.startTime,jdbcType=VARCHAR} and a.MIDWARE_OPER_TIME<= #{baseParam.endTime,jdbcType=VARCHAR}
      ]]>
      </if>
      </if> 
    ORDER BY MIDWARE_OPER_TIME DESC   
  </select>
  <delete id="deleteByPrimaryKey" parameterType="com.dcits.ensemble.om.oms.module.middleware.EcmMidwareoprInfo">
    delete from ECM_MIDWAREOPR_INFO
    where MIDWARE_OPER_ID = #{midwareOperId,jdbcType=INTEGER}
  </delete>
  <update id="updateByPrimaryKey" parameterType="com.dcits.ensemble.om.oms.module.middleware.EcmMidwareoprInfo">
    update ECM_MIDWAREOPR_INFO
    <set>
      <if test="midwareIntantId != null">
        MIDWARE_INTANT_ID = #{midwareIntantId,jdbcType=INTEGER},
      </if>
      <if test="midwareType != null">
        MIDWARE_TYPE = #{midwareType,jdbcType=VARCHAR},
      </if>
      <if test="midwareOperType != null">
        MIDWARE_OPER_TYPE = #{midwareOperType,jdbcType=VARCHAR},
      </if>
      <if test="midwareOperTime != null">
        MIDWARE_OPER_TIME = #{midwareOperTime,jdbcType=VARCHAR},
      </if>
      <if test="midwareOperUserid != null">
        MIDWARE_OPER_USERID = #{midwareOperUserid,jdbcType=INTEGER}
      </if>
    </set>
    where MIDWARE_OPER_ID = #{midwareOperId,jdbcType=INTEGER}
  </update>
  <insert id="insert" parameterType="com.dcits.ensemble.om.oms.module.middleware.EcmMidwareoprInfo">
    insert into ECM_MIDWAREOPR_INFO
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="midwareOperId != null">
        MIDWARE_OPER_ID,
      </if>
      <if test="midwareIntantId != null">
        MIDWARE_INTANT_ID,
      </if>
      <if test="midwareType != null">
        MIDWARE_TYPE,
      </if>
      <if test="midwareOperType != null">
        MIDWARE_OPER_TYPE,
      </if>
      <if test="midwareOperTime != null">
        MIDWARE_OPER_TIME,
      </if>
      <if test="midwareOperUserid != null">
        MIDWARE_OPER_USERID,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="midwareOperId != null">
        #{midwareOperId,jdbcType=INTEGER},
      </if>
      <if test="midwareIntantId != null">
        #{midwareIntantId,jdbcType=INTEGER},
      </if>
      <if test="midwareType != null">
        #{midwareType,jdbcType=VARCHAR},
      </if>
      <if test="midwareOperType != null">
        #{midwareOperType,jdbcType=VARCHAR},
      </if>
      <if test="midwareOperTime != null">
        #{midwareOperTime,jdbcType=VARCHAR},
      </if>
      <if test="midwareOperUserid != null">
        #{midwareOperUserid,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
</mapper>